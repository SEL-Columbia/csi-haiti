<html>
	<head>
		<script src='wax/ext/leaflet.js' type='text/javascript'></script>
		<script src='wax/dist/wax.leaf.js' type='text/javascript'></script>
		<script src='ucsv-1.0.1-min.js' type='text/javascript'></script>
		<script src='http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js' type='text/javascript'></script>
		<link href='wax/ext/leaflet.css' rel='stylesheet' type='text/css' />
	</head>
	<body>
		<div style='width: 100%; height: 100%;' id='map-div'></div>
        <div id='result'></div>
		<script>
			var url = 'http://a.tiles.mapbox.com/v3/modilabs.map-nuhzv2tu.jsonp';
			wax.tilejson(url,
			    function(tilejson) {
			    var map = new L.Map('map-div')
				    .addLayer(new wax.leaf.connector(tilejson))
				    .setView(new L.LatLng(18.233748078346252, -74.02795493602753), 11);
		        wax.leaf.interaction(map, tilejson);
                $('#result').load('ict4ag_finalform_2_2012_02_10.csv', function() {
                    var array = CSV.csvToArray($('#result').html());
                    var gps_col = 0;
                    for (; gps_col < array[0].length; gps_col++) {
                        if (array[0][gps_col] == 'gps_home')
                            break;
                    }
                    var i = 1;
                    var geo, lat, lng;
                    for (; i < array.length; i++) {
                        geo = array[i][gps_col].split(' ');
                        lat = Number(geo[0]);
                        lng = Number(geo[1]);
                        var marker = new L.Marker(new L.LatLng(lat, lng));
                        map.addLayer(marker);
                    }
                });
			});
		</script>
	</body>
</html>
